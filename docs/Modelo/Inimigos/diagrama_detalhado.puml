@startuml
!theme materia
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam crossingCharacter '( )'
skinparam classSeparatorColor DarkRed
skinparam classSeparatorThickness 2

' --- CONFIGURAÇÕES GERAIS ---
skinparam wrapWidth 350
skinparam nodesep 40
skinparam ranksep 40

title Modelo.Inimigos (Layout Estritamente Vertical)

' =================================================
' BLOCO 1 (TOPO): ENTIDADES DO JOGO
' =================================================
package "Entidades do Jogo" {
    abstract class Inimigo {
        + lootTable: LootTable
        + vida: double
        # faseReferencia: Fase
        # initialX: double
        --
        + Inimigo(sNomeImagePNG: String, x: double, y: double, lootTable: LootTable, vida: double)
        + initialize(fase: Fase): void
        + setInitialX(initialX: double): void
        {abstract} + isStrafing(): boolean
        + takeDamage(damage: double): void
        + getAnguloEmDirecaoAoHeroi(): double
        # processarEstado(estado: Estado, tempo: int): Estado
    }

    abstract class Boss extends Inimigo {
        - isBombed: boolean
        --
        + Boss(sNomeImagePNG: String, x: double, y: double, lootTable: LootTable, vida: double)
        + setBombed(bombed: boolean): void
        + isBombed(): boolean
    }

    class GerenciadorDeAnimacaoInimigo {
        + AnimationState: enum
        - iImagesIdle: ImageIcon[]
        - iImagesStrafing: ImageIcon[]
        --
        + GerenciadorDeAnimacaoInimigo(...)
        + atualizar(state: AnimationState): void
        + getImagemAtual(state: AnimationState): ImageIcon
    }

    ' --- GRADE DE FADAS (2x2) ---
    package "Fadas" {
        class FadaComum1 extends Inimigo {
            - animador: GerenciadorDeAnimacaoInimigo
            --
            + FadaComum1(...)
            + atualizar(): void
            - atirar(): void
        }
        
        class FadaComum2 extends Inimigo {
            - animador: GerenciadorDeAnimacaoInimigo
            --
            + FadaComum2(...)
            + atualizar(): void
            - atirarEmCirculo(...): void
        }
        
        class FadaComum3 extends Inimigo {
            - animador: GerenciadorDeAnimacaoInimigo
            --
            + FadaComum3(...)
            + atualizar(): void
        }
        
        class FadaComum4 extends Inimigo {
            - animador: GerenciadorDeAnimacaoInimigo
            --
            + FadaComum4(...)
            + atualizar(): void
        }
    }

    ' --- GRADE DE BOSSES (2x3) ---
    package "Chefes" {
        class Nightbug extends Boss {
            - animador: GerenciadorDeAnimacaoInimigo
            - estado: Estado
            --
            + Nightbug(...)
            + atualizar(): void
        }
        
        class Lorelei extends Boss {
            - animador: GerenciadorDeAnimacaoInimigo
            - estadoDeAtaque: Estado
            --
            + Lorelei(...)
            + atualizar(): void
        }
        
        class Keine extends Boss {
            - animador: GerenciadorDeAnimacaoInimigo
            - estado: Estado
            --
            + Keine(...)
            + atualizar(): void
        }
        
        class Reimu extends Boss {
            - animador: GerenciadorDeAnimacaoInimigo
            - estadoMovimento: Estado
            - estadoAtaque: Estado
            --
            + Reimu(...)
            + atualizar(): void
        }
        
        class Reisen extends Boss {
            - animador: GerenciadorDeAnimacaoInimigo
            - estado: Estado
            --
            + Reisen(...)
            + atualizar(): void
        }
    }
}

' =================================================
' BLOCO 2 (BASE): LÓGICA E ESTADOS
' =================================================
package "Lógica de IA (Estados)" {
    abstract class "Estado" as Estado {
        # inimigo: Inimigo
        - proximoEstado: Estado
        # contadorTempo: int
        # estadoCompleto: boolean
        --
        + Estado(inimigo: Inimigo)
        {abstract} + incrementarTempo(fase: Fase, tempo: int): void
        + reset(): void
        + setProximoEstado(proximoEstado: Estado): void
        + getProximoEstado(): Estado
        + getEstadoCompleto(): boolean
    }

    class "Esperar" as Esperar extends Estado {
        - duracao: int
        --
        + Esperar(inimigo: Inimigo, duracao: int)
    }

    class "IrPara" as IrPara extends Estado {
        - movimento: Movimento
        --
        + IrPara(inimigo: Inimigo, alvoX: double, alvoY: double, velocidade: double)
        + IrPara(inimigo: Inimigo, alvoX: double, alvoY: double, velX: double, velY: double)
        + setMovimento(movimento: Movimento): void
        + getMovimento(): Movimento
    }
    
    class "Movimento" as Movimento {
        - velocidade: Point2D.Double
        - alvo: Point2D.Double
        --
        + Movimento(velocidade: Point2D.Double, alvo: Point2D.Double)
        + proximoMovimento(posicaoX: double, posicaoY: double): Point2D.Double
        {static} + isZero(movimento: Point2D.Double): boolean
        + setAlvo(novoAlvo: Point2D.Double): void
        + getAlvo(): Point2D.Double
    }

    abstract class "Ataque" as Ataque extends Estado {
        # intervaloAtaque: int
        # velocidadeProjetil: double
        # padroes: ArrayList<PadraoAtaque>
        --
        + Ataque(boss: Boss)
        + reset(): void
        {abstract} # atirar(padrao: PadraoAtaque): void
    }
    
    class "PadraoAtaque" as PadraoAtaque {
        - rotacao: int
        - quantidadeAtaques: int
        - repeticoes: int
        --
        + PadraoAtaque(rot: int, qtd: int, rep: int)
        + getRotacao(): int
    }

    class "MultiplosEstados" as MultiplosEstados extends Estado {
        # estados: ArrayList<Estado>
        # repeticoes: int
        --
        + MultiplosEstados(boss: Boss)
        + reset(): void
    }
    
    ' Agrupando ataques específicos
    package "Tipos de Ataque" {
        abstract class "AtaqueEmColuna" as AtaqueEmColuna extends Ataque {
            + AtaqueEmColuna(boss: Boss)
            # atirarEmLinha(...): void
        }
        
        class "AtaqueEmUmaLinha" as AtaqueEmUmaLinha extends AtaqueEmColuna {
            # coluna: Coluna
            --
            + AtaqueEmUmaLinha(boss: Boss, pIni: Point2D, pFim: Point2D)
        }
        
        class "AtaqueEmUmaLinhaNoJogador" as AtaqueEmUmaLinhaNoJogador extends AtaqueEmUmaLinha {
            + AtaqueEmUmaLinhaNoJogador(boss: Boss)
        }

        abstract class "AtaqueEmLeque" as AtaqueEmLeque extends Ataque {
            + AtaqueEmLeque(boss: Boss)
            # atirarEmLeque(...): void
        }
        
        class "AtaqueEmLequeNoJogador" as AtaqueEmLequeNoJogador extends AtaqueEmLeque {
            + AtaqueEmLequeNoJogador(boss: Boss)
        }
        
        class "AtaqueEmLequeNaPosicao" as AtaqueEmLequeNaPosicao extends AtaqueEmLeque {
            # posicaoAtaque: Point2D.Double
            --
            + AtaqueEmLequeNaPosicao(boss: Boss)
        }
    }
}

' =================================================
' LAYOUT FORÇADO (A CORREÇÃO)
' =================================================

' 1. Organiza as Entidades (Interno)
Inimigo -[hidden]down-> Boss
Inimigo -[hidden]right-> GerenciadorDeAnimacaoInimigo
Boss -[hidden]down-> "Fadas"
"Fadas" -[hidden]down-> "Chefes"

' 2. Organiza Grades de Entidades
FadaComum1 -[hidden]right-> FadaComum2
FadaComum1 -[hidden]down-> FadaComum3
FadaComum3 -[hidden]right-> FadaComum4

Nightbug -[hidden]right-> Lorelei
Nightbug -[hidden]down-> Keine
Keine -[hidden]right-> Reimu
Keine -[hidden]down-> Reisen

' 3. A GRANDE QUEBRA: Conecta o FUNDO das Entidades ao TOPO da IA
' Isso impede que a IA flutue para o lado.
FadaComum4 -[hidden]down-> Estado
Reisen -[hidden]down-> Estado

' 4. Organiza a IA (Interno) em grade para economizar altura
Estado -[hidden]down-> Esperar
Esperar -[hidden]right-> IrPara
IrPara -[hidden]right-> Movimento
Movimento -[hidden]right-> Ataque
Ataque -[hidden]down-> MultiplosEstados
Ataque -[hidden]right-> "Tipos de Ataque"
MultiplosEstados -[hidden]right-> "Tipos de Ataque"

' 5. Relacionamentos Reais
Inimigo +-- GerenciadorDeAnimacaoInimigo
IrPara +-- Movimento
Ataque +-- PadraoAtaque
Inimigo +-- Estado

@enduml